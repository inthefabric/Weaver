using System;
using System.Linq.Expressions;
using Weaver.Core.Elements;
using Weaver.Core.Query;
using Weaver.Core.Steps;

namespace Weaver.Core.Pipe {
	
	/*================================================================================================*/
	public interface IWeaverPathPipe : IWeaverPathPipeEnd {


		////////////////////////////////////////////////////////////////////////////////////////////////
		/*--------------------------------------------------------------------------------------------*/
		IWeaverPathPipeEnd Count();

		/*--------------------------------------------------------------------------------------------*/
		IWeaverPathPipeEnd Iterate();

	}


	/*================================================================================================*/
	public interface IWeaverPathPipe<T> : IWeaverPathPipe where T : class, IWeaverElement {


		////////////////////////////////////////////////////////////////////////////////////////////////
		/*--------------------------------------------------------------------------------------------* /
		IWeaverQuery Prop(Expression<Func<T, object>> pProperty);


		////////////////////////////////////////////////////////////////////////////////////////////////
		/*--------------------------------------------------------------------------------------------*/
		T As(out IWeaverStepAs<T> pAlias);

		/*--------------------------------------------------------------------------------------------*/
		TBack Back<TBack>(IWeaverStepAs<TBack> pAlias) where TBack : IWeaverElement;

		/*--------------------------------------------------------------------------------------------*/
		T Has(Expression<Func<T, object>> pProperty, WeaverStepHasOp pOperation, object pValue);

		/*--------------------------------------------------------------------------------------------*/
		T Has(Expression<Func<T, object>> pProperty);

		/*--------------------------------------------------------------------------------------------*/
		T HasNot(Expression<Func<T, object>> pProperty, WeaverStepHasOp pOperation, object pValue);

		/*--------------------------------------------------------------------------------------------*/
		T HasNot(Expression<Func<T, object>> pProperty);

		/*--------------------------------------------------------------------------------------------* /
		T UpdateEach(WeaverUpdates<T> pUpdates);

		/*--------------------------------------------------------------------------------------------* /
		T RemoveEach();

		/*--------------------------------------------------------------------------------------------* /
		T Table(IWeaverTableVarAlias pAlias, WeaverTableColumns pColumns) where T : IWeaverPathItem;


		////////////////////////////////////////////////////////////////////////////////////////////////
		/*--------------------------------------------------------------------------------------------*/
		T Next(int? pCount=null);

		/*--------------------------------------------------------------------------------------------*/
		T Aggregate(IWeaverVarAlias pVar);

		/*--------------------------------------------------------------------------------------------*/
		T Retain(IWeaverVarAlias pVar);

		/*--------------------------------------------------------------------------------------------*/
		T Except(IWeaverVarAlias pVar);

		/*--------------------------------------------------------------------------------------------*/
		T Dedup();

		/*--------------------------------------------------------------------------------------------*/
		T Limit(int pStartIndex, int pEndIndex);

		/*--------------------------------------------------------------------------------------------*/
		T AtIndex(int pIndex);


		////////////////////////////////////////////////////////////////////////////////////////////////
		/*--------------------------------------------------------------------------------------------*/
		T CustomStep(string pScript, bool pSkipDotPrefix=false);

	}

}